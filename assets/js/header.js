!function(f,m){"use strict";function o(t,e){var o=this;m&&m.template&&(o.$el=t,o.options=e,o.$elements=o.$el.find(o.options.elements),o.$elements.find(o.options.addbutton).on("click",f.proxy(o.add_block,o)),o.update_buttons())}o.prototype.$el=null,o.prototype.$elements=null,o.prototype.options=null,o.prototype.add_block=function(t){t.preventDefault();var e=this,o=f(t.target||t.currentTarget).closest(e.options.elements),n=o.find(e.options.item).length;if(!(3<=n)){var i=m.template(e.options.sources.block),s=f(i({header:o.attr("data-h")}));o.append(s),e.update_buttons(),s.find(e.options.editbutton).click()}},o.prototype.edit_block=function(t){t.preventDefault();var e=this;f(t.target||t.currentTarget).closest(e.options.item).find(e.options.modes).addClass(e.options.opened)},o.prototype.remove_block=function(t){t.preventDefault();var e=this,o=f(t.target||t.currentTarget).closest(e.options.item);o.css("background",e.options.color),o.animate({opacity:"0"},"slow",function(){o.remove(),e.update_buttons()})},o.prototype.update_block=function(t){t.preventDefault();var e=this,o=f(t.target||t.currentTarget),n=o.closest(e.options.elements),i=o.closest(e.options.item),s=i.find(e.options.content),a=i.find(e.options.modes),d=i.find(".add"),p=i.find(".edit"),l=a.attr("data-m"),r=a.find("select option:selected").val();if(l!=r)if(s.empty(),""!=r){var c=m.template(e.options.sources[r]),u=f(c({name:n.attr("data-n")}));s.append(u),d.hide(),p.show()}else d.show(),p.hide();a.attr("data-m",r),a.removeClass(e.options.opened)},o.prototype.update_buttons=function(){var a=this;a.$elements.find(a.options.editbutton).off("click"),a.$elements.find(a.options.removebutton).off("click"),a.$elements.find(a.options.updatebutton).off("click"),f.each(a.$elements,function(t,e){var o=f(e),n=o.find(a.options.addbutton),i=o.find(a.options.item).length;if(0<=i&&i<3){n.show();var s=o.find(a.options.enable);0==i&&s.is(":checked")&&o.find(a.options.enable).click()}else n.hide()}),a.$elements.find(a.options.editbutton).on("click",f.proxy(a.edit_block,a)),a.$elements.find(a.options.removebutton).on("click",f.proxy(a.remove_block,a)),a.$elements.find(a.options.updatebutton).on("click",f.proxy(a.update_block,a))};var e={init:function(t){if(!this.length)return!1;var e={color:"#ffaaaa",elements:".header",enable:".enable",item:"fieldset",content:".content",modes:".modes",opened:"opened",addbutton:".add-button",editbutton:".edit-button",removebutton:".remove-button",updatebutton:".update-button",sources:{block:"template-id",logo:"template-logo-id",nav:"template-nav-id",search:"template-search-id",text:"template-text-id"}};return this.each(function(){t&&f.extend(e,t),new o(f(this),e)})}};f.fn.dionysosHeader=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(f.error("Method "+t+" does not exist on dionysosHeader"),!1):e.init.apply(this,arguments)}}(window.jQuery,window.wp);